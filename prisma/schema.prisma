datasource db {
  provider  = "postgresql"
  // url       = env("PROD_DATABASE_URL")
  // directUrl = env("PROD_DIRECT_URL")
  url       = env("DEV_DATABASE_URL")
  directUrl = env("DEV_DIRECT_URL")
}

generator client {
  // Prisma Python client provider
  provider             = "prisma-client-py"
  // Asynchronous interface to use
  interface            = "asyncio"
  // Recursive type depth not limited (-1)
  recursive_type_depth = -1
}

enum CaseType {
  BAN
  UNBAN
  HACKBAN
  TEMPBAN
  KICK
  TIMEOUT
  UNTIMEOUT
  WARN
  JAIL
  UNJAIL
}

model Guild {
  guild_id        BigInt        @id
  guild_joined_at DateTime?     @default(now())
  cases           Case[]
  snippets        Snippet[]
  notes           Note[]
  reminders       Reminder[]
  guild_config    GuildConfig[]

  @@unique([guild_id])
  @@index([guild_id])
}

model GuildConfig {
  mod_log_id           BigInt?
  audit_log_id         BigInt?
  join_log_id          BigInt?
  private_log_id       BigInt?
  report_log_id        BigInt?
  dev_log_id           BigInt?
  jail_channel_id      BigInt?
  general_channel_id   BigInt?
  starboard_channel_id BigInt?
  perm_level_0_role_id BigInt?
  perm_level_1_role_id BigInt?
  perm_level_2_role_id BigInt?
  perm_level_3_role_id BigInt?
  perm_level_4_role_id BigInt?
  perm_level_5_role_id BigInt?
  perm_level_6_role_id BigInt?
  perm_level_7_role_id BigInt?
  perm_level_8_role_id BigInt?
  perm_level_9_role_id BigInt?
  base_staff_role_id   BigInt?
  base_member_role_id  BigInt?
  jail_role_id         BigInt?
  quarantine_role_id   BigInt?

  guild_id BigInt @id
  guild    Guild? @relation(fields: [guild_id], references: [guild_id])

  @@unique([guild_id])
  @@index([guild_id])
}

model Case {
  case_id           BigInt    @id @default(autoincrement())
  case_status       Boolean?  @default(true) // True for active, false for inactive
  case_type         CaseType
  case_reason       String
  case_moderator_id BigInt
  case_target_id    BigInt
  case_target_roles BigInt[]  @default([]) // Role IDs for the jailed user
  case_number       BigInt? // Incremented for each case per guild via a trigger/function
  case_created_at   DateTime? @default(now())
  case_expires_at   DateTime? // For temporary bans and timeouts
  guild_id          BigInt
  guild             Guild     @relation(fields: [guild_id], references: [guild_id])

  @@unique([case_number, guild_id])
  @@index([case_number, guild_id])
}

model Snippet {
  snippet_id         BigInt   @id @default(autoincrement())
  snippet_name       String
  snippet_content    String
  snippet_user_id    BigInt
  snippet_created_at DateTime @default(now())
  guild_id           BigInt
  guild              Guild    @relation(fields: [guild_id], references: [guild_id])

  @@unique([snippet_name, guild_id])
  @@index([snippet_name, guild_id])
}

model Note {
  note_id           BigInt   @id @default(autoincrement())
  note_content      String
  note_created_at   DateTime @default(now())
  note_moderator_id BigInt
  note_target_id    BigInt
  note_number       BigInt? // Incremented for each note per guild via a trigger/function
  guild_id          BigInt
  guild             Guild    @relation(fields: [guild_id], references: [guild_id])

  @@unique([note_number, guild_id])
  @@index([note_number, guild_id])
}

model Reminder {
  reminder_id         BigInt   @id @default(autoincrement())
  reminder_content    String
  reminder_created_at DateTime @default(now())
  reminder_expires_at DateTime
  reminder_channel_id BigInt // Channel to send the reminder to if direct message fails
  reminder_user_id    BigInt
  guild_id            BigInt
  guild               Guild    @relation(fields: [guild_id], references: [guild_id])

  @@unique([reminder_id, guild_id])
  @@index([reminder_id, guild_id])
}
